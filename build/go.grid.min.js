/*! go.grid 2015-04-01 */
(function(){angular.module("goGridDiacritics",[]).factory("removeDiacritics",function(){var a;return a=[{base:"azzz",letters:/[ą]/g},{base:"zzzz",letters:/[żź]/g},{base:"szzz",letters:/[ś]/g},{base:"ezzz",letters:/[ę]/g},{base:"czzz",letters:/[ć]/g},{base:"nzzz",letters:/[ń]/g},{base:"ozzz",letters:/[ó]/g},{base:"lzzz",letters:/[ł]/g}],function(b){var c;for(c=a.length-1;c>=0;)b=b.replace(a[c].letters,a[c].base),c--;return b}})}).call(this),function(){angular.module("goGridClass",["goGridXLSExporter"]).factory("gridClass",["XLSExport",function(a){var b;return b=function(){function b(b,c,d,e,f,g){this.scope=b,this.element=c,this.attrs=d,this.ctrl=e,this.transclude=f,this.scope.hideHeader=d.hideHeader,this.xls_export=new a(d.name,b.columns,b.data),this.scope.exportCSV=function(a){return function(){return a.xls_export.doExport(a.scope,g)}}(this)}return b.prototype.buildColumns=function(a){var b,c,d,e,f,g,h,i;d=a.get(this.scope.name+".columns")||{},f=[];for(e in d)b=d[e],f[b.index]=null;for(i=this.scope.columnsDef,g=0,h=i.length;h>g;g++)b=i[g],c=d[b.name],c&&null!=c.index?(f[c.index]=$.extend({},b),f[c.index].visible=c.visible,c.width&&(f[c.index].width=c.width)):f.push(b);return f=f.filter(function(a){return a}),this.scope.columnGroups=[],this.scope.columnsGroupped=[],this.scope.columns=f},b.prototype.groupColumns=function(){var a,b,c,d,e,f,g,h,i;for(b=[],c=[],d=this.scope.columns.filter(function(a){return a.visible}),e=f=0,g=d.length;g>f;e=++f)a=d[e],a.group?(c.push(a),d[e-1]&&a.group===d[e-1].group?d[e-1]&&a.group===d[e-1].group&&b[b.length-1].span++:b.push({header:a.group,span:1,type:"group"})):b.push(a);return this.scope.columnGroups.splice(0,this.scope.columnGroups.length),this.scope.columnsGroupped.splice(0,this.scope.columnsGroupped.length),(h=this.scope.columnGroups).push.apply(h,b),(i=this.scope.columnsGroupped).push.apply(i,c)},b.prototype.watchColumns=function(a){var b,c,d,e,f,g;for(c={},g=this.scope.columns,d=e=0,f=g.length;f>e;d=++e)b=g[d],c[b.name]={visible:b.visible,width:b.width,index:d};return a.set(this.scope.name+".columns",c),this.groupColumns()},b.prototype.watchSource=function(a){var b;if(this.attrs.source){if(b=a(this.attrs.source)(this.scope),!b)return this.scope.source.data=[];if(b.$resolved)return this.scope.source.data=b;if(this.scope.source.data=[],b.$promise)return b.$promise.then(function(b){return function(){return b.scope.source.data=a(b.attrs.source)(b.scope)}}(this))}},b.prototype.infiniteScroll=function(a){return this.scope.$watch("viewParams.pageSize",function(a){return function(b,c){return b!==c?a.scope.infinite():void 0}}(this)),this.scope.$watch("viewParams.length",function(b){return function(){return a(function(){var a;return b.scope.viewParams.page=1,a=$(b.element).find(".go-grid-table-body td").height()||29,$(b.element).find(".go-grid-table-body > div").height(b.scope.viewParams.length*a),$(b.element).find(".go-grid-table-body").scrollTop(0)},10)}}(this)),this.scope.$watch("viewParams.page",function(a){return function(){var b,c;return parseInt(a.scope.viewParams.page)>2?(c=($(a.element).find(".go-grid-table-body table td ").height()||29)+1,b=c*a.scope.viewParams.pageSize*(parseInt(a.scope.viewParams.page)-2),$(a.element).find(".go-grid-table-body > div").css({paddingTop:b})):$(a.element).find(".go-grid-table-body > div").css({paddingTop:0})}}(this))},b.prototype.cellStyleSetters=function(){return this.scope.cellStyle=function(a,b){return{color:a.active||a.selected?a["_"+b.name+"color_"]:a["_"+b.name+"color_"]||a._color_,backgroundColor:a.active||a.selected?a["_"+b.name+"bgcolor_"]:a["_"+b.name+"bgcolor_"]||a._bgcolor_,borderColor:a.active||a.selected?a["_"+b.name+"bgcolor_"]:a["_"+b.name+"bgcolor_"]||a._bgcolor_}},this.scope.emptyCellStyle=function(a){return{backgroundColor:a.active||a.selected?null:a._bgcolor,borderColor:a.active||a.selected?null:a._bgcolor_}},this.scope.rowClass=function(a){return function(b){return{active:b.active,selected:b.selected,highlighted:b===a.scope.highlighted}}}(this),this.scope.columnWidth=function(a){return{width:a.width}}},b}()}])}.call(this),function(){angular.module("goGridControllers",["goGridDiacritics"]).controller("GoGridController",["$scope","storage","removeDiacritics",function(a,b,c){return a.columnsDef=[],a.columns=[],a.viewParams={sort_by:[],page:1,pageSize:1,length:0,filtersVisible:!0,filters:{},sort_columns:{}},a.saved_filter_values=b.get(a.name+".filter_values")||{},a.highlight=function(b){return a.highlighted=b,a.onSelect?a.onSelect(b):void 0},a.filter=function(){var b,c,d,e;if(c=a.viewParams.filters,d=a.source.data||[],c){for(e in c)b=c[e],"text"===b.type&&b.exp&&(d=d.filter(function(a){var c,d,e,f,g,h;for(e=[],h=b.fields,f=0,g=h.length;g>f;f++)c=h[f],e.push(a[c]);return d=b.exp.test(e.join(" ")),a.__go_grid_hidden=d?!1:!0,d})),"check"!==b.type||b.value||(d=d.filter(function(a){var c;return c=a[b.field].toString()===b.selected,a.__go_grid_hidden=c?!1:!0,c})),"list"===b.type&&(b.value||[]).length>0&&(d=d.filter(function(a){var c;return c=b.value.indexOf(a[b.field])>=0,a.__go_grid_hidden=c?!1:!0,c}));d.length<a.viewParams.length&&(a.viewParams.page=1),a.viewParams.length=d.length}return a.filtered=d,a.sort(),a.viewParams.infinite?a.infinite():void 0},a.sort=function(){var b,d,e,f,g,h,i,j,k;if(e=a.filtered,a.viewParams.sort_by.length&&e.length>1){for(f=a.viewParams.sort_by[0].column,b=e[0][f],$.isNumeric(b)?(console.log(b),g=function(){return("000000000000000000000000"+this[f].toFixed(20)).substr(-25)}):g=function(){return c(this[f]||"")},h=0,j=e.length;j>h;h++)d=e[h],d.toString=g;for(e=e.sort(),i=0,k=e.length;k>i;i++)d=e[i],delete d.toString;return a.filtered=a.viewParams.sort_by[0].direction<0?e.reverse():e}},a.infinite=function(){var b,c,d;return c=a.filtered,a.viewParams.infinite&&(d=0,parseInt(a.viewParams.page)>2&&(d=(parseInt(a.viewParams.page)-2)*a.viewParams.pageSize),0>d&&(d=0),b=(parseInt(a.viewParams.page)+1)*a.viewParams.pageSize,c=c.slice(d,b)),a.truncated=c}}])}.call(this),function(){angular.module("goGridFilters",[]).directive("filters",["$compile",function(){return{restrict:"E",link:function(a,b){return a.filters=[],a.viewParams.filtersTpl=b.html()}}}]).directive("multiFilter",["$compile","storage","$timeout",function(a,b,c){return{restrict:"E",link:function(a,d,e){var f,g,h;return f='<select multiselect multiple="multiple" ng-model="viewParams.filters.'+(e.field||e.name)+'.value" ng-options="item.id as item.label for item in '+e.items+'"></select>',((g=a.viewParams).filters||(g.filters={}))[e.name]?void 0:(((h=a.viewParams).filters||(h.filters={}))[e.name]={type:"list",field:e.name,value:[]},c(function(){var c;return((c=a.viewParams).filters||(c.filters={}))[e.name].value=b.get(a.name+"_filter_"+e.name),a.$watch("viewParams.filters."+e.name+".value",function(c){return a.filter(),b.set(a.name+"_filter_"+e.name,c)})},30),d.html(f))}}}]).directive("searchFilter",["$compile","storage","$timeout",function(a,b,c){return{restrict:"E",link:function(a,d,e){var f,g,h;return f='<input class="form-control" ng-model="viewParams.filters.'+e.name+'.value" />',((g=a.viewParams).filters||(g.filters={}))[e.name]?void 0:(((h=a.viewParams).filters||(h.filters={}))[e.name]={type:"text",fields:e.fields.split(","),name:e.name,value:""},d.html(f),c(function(){var c,d,f;((f=a.viewParams).filters||(f.filters={}))[e.name].value=b.get(a.name+"_filter_"+e.name)||"",d=a.viewParams.filters[e.name].value.replace("%","(.)+"),d="(?=.*"+d.split("&").join(")(?=.*")+")";try{a.viewParams.filters[e.name].exp=new RegExp("("+d+")","i")}catch(g){c=g}return a.filter(),a.$watch("viewParams.filters."+e.name+".value",function(f,g){if(f!==g){b.set(a.name+"_filter_"+e.name,f),d=a.viewParams.filters[e.name].value.replace("%","(.)+"),d="(?=.*"+d.split("&").join(")(?=.*")+")";try{a.viewParams.filters[e.name].exp=new RegExp("("+d+")","i")}catch(h){c=h}return a.filter()}})},100))}}}]).directive("checkFilter",["$compile",function(){return{restrict:"E",link:function(a,b,c){var d,e,f;return d='<button class="btn btn-default" ng-click="viewParams.filters.'+c.name+".value = !viewParams.filters."+c.name+'.value"><span class="fa" ng-class="{\'fa-square-o\': !viewParams.filters.'+c.name+".value,'fa-check-square-o': viewParams.filters."+c.name+'.value}"></span> '+c.label+"</button>",((e=a.viewParams).filters||(e.filters={}))[c.name]?void 0:(a.$watch("viewParams.filters."+c.name+".value",function(b,c){return b!==c?a.filter():void 0}),((f=a.viewParams).filters||(f.filters={}))[c.name]={type:"check",field:c.field,name:c.name,value:c.initial||!1,selected:c.value},b.html(d))}}}]).directive("filtersContainer",["$compile",function(a){return{restrict:"A",compile:function(){return function(b,c){return c.html("<div ng-include=\"'filters_container.html'\"></div>"),c.append(b.viewParams.filtersTpl),a(c.contents())(b)}}}}])}.call(this),function(){angular.module("goGridTemplates",[]).run(["$templateCache",function(a){return a.put("grid_column.html",'<div ng-style="{width: column.width}"><span class="header-label">{{ ::column.header }}</span><span ng-if="::column.sortable" class="sorting-arrows fa" ng-class="{\'fa-unsorted\': !viewParams.sort_columns[column.name], \'fa-sort-up\': viewParams.sort_columns[column.name] == 1, \'fa-sort-desc\': viewParams.sort_columns[column.name] == -1}"></span></div>'),a.put("filters_container.html",'<div class="go-grid-column-list"><button class="btn btn-default" type="button" data-toggle="dropdown"><span class="fa fa-cogs"></span></button><ul class="dropdown-menu pull-right" role="menu"><li><a href="javascript:void(0)" ng-click="resetStorage()">Reset ustawień</a></li><li class="dropdown-header"><strong>Kolumny</strong></li><li ng-repeat="(index, column) in columns"><column-config></column-config></li></ul> <button class="btn btn-default" ng-click="exportCSV()"><span class="fa fa-cloud-download"></span></button>&nbsp;<button class="btn btn-default" ng-click="refresh()" ng-if="refresh "><span class="fa fa-refresh"></span></button></div>'),a.put("grid_base.html",'<div class="go-grid-table"><div class="go-grid-filters form-inline" ng-if="::viewParams.filtersVisible" filters-container></div><div class="go-grid-table-header"><table><thead><tr><th column-header column="column" ng-repeat="column in columnGroups" colspan="{{column.span}}" rowspan="{{column.type == \'group\' ? 1 : 2}}" ng-class="{group: column.type == \'group\'}"></th><th style="width: 100%; min-width: 50px" rowspan="2"></th></tr><tr><th column-header ng-repeat="column in columnsGroupped" column="column"></th></tr></thead></table></div><div class="go-grid-table-body" scroll-table><div><table><tbody><tr ng-repeat="(row_index,item) in truncated track by $index" ng-class="rowClass(item)"><td ng-repeat="column in columns" go-cell ng-if="column.visible" ngs-click="highlight(item)" ng-style="cellStyle(item, column)"></td><td style="width: 100%" ng-style="emptyCellStyle(item)"></td></tr></tbody></table></div></div></div>\n')}])}.call(this),function(){angular.module("goGridColumns",[]).directive("columns",["$parse","$timeout",function(a){return{restrict:"E",link:function(b,c,d){var e,f,g,h;if(null!=d.source)for(h=a(d.source)(b),f=0,g=h.length;g>f;f++)e=h[f],"undefined"==typeof e.sortable&&(e.sortable=!0),"undefined"==typeof e.resizable&&(e.resizable=!0),"undefined"==typeof e.hidden&&(e.visible=!1),e.visible=null==e.hidden&&"false"!==e.hidden,e.template||(e.template=""),b.columnsDef.push(e);return!0}}}]).directive("column",[function(){return{restrict:"E",link:function(a,b,c){var d;return d=c.template||b.html(),d=d.replace(/go-(ng-repeat|ng-href)/g,"$1"),a.columnsDef.push({name:c.name,width:c.width,header:c.header,sort:c.sort,sortable:null!=c.sort&&"false"!==c.sort,visible:null==c.hidden&&"false"!==c.hidden,resizable:null!=c.resize&&"false"!==c.resize,template:d,group:c.group||"",right:null!=c.right&&"false"!==c.right}),null!=c.sortDefault?(a.viewParams.sort_by=[{column:c.sort||c.name,direction:1}],a.viewParams.sort_columns={},a.viewParams.sort_columns[c.sort||c.name]=1):void 0}}}]).directive("checkboxColumn",[function(){return{restrict:"E",link:function(a,b,c){var d;return d=c.field||"selected",a.columnsDef.push({field:d,visible:null==c.hidden,width:c.width,header:"Operacje grupowe",type:"checkbox",name:c.name||"checkbox",template:'<input type="checkbox" class="checkbox" ng-model="item.'+d+'" />'})}}}]).directive("columnHeader",["$compile",function(){return{restrict:"A",templateUrl:"grid_column.html",link:function(a,b){var c;return a.column.right&&b.addClass("text-right"),"checkbox"===a.column.type?(b.html('<div style="width: '+a.column.width+'px; padding: 0 0 0 6px"><input type="checkbox" class="checkbox" /></div>'),b.find("input").on("click",function(){var b,c,d,e,f,g,h;for(g=a.filtered,c=0,e=g.length;e>c;c++)b=g[c],b[a.column.field]=!1;if($(this).prop("checked"))for(h=a.filtered,d=0,f=h.length;f>d;d++)b=h[d],b[a.column.field]=!0;return a.$apply(),!0})):(a.column.resizable&&$(b).children("div").resizable({handles:"e",stop:function(){return a.$parent.$broadcast("columnResize"),a.$apply(function(b){return function(){return a.column.width=$(b).width()+8}}(this))}}),a.column.sortable?(b.addClass("sortable"),c=a.column.sort||a.column.name,$(b).on("click",function(b){return a.$apply(function(){var b,d,e;return d=a.viewParams.sort_by.filter(function(a){return a.column===c}),b=d?d.direction:-1,a.viewParams.sort_by=[],(e=a.viewParams.sort_by)[0]||(e[0]={}),a.viewParams.sort_by[0].column=c,a.viewParams.sort_by[0].direction=-1*b,a.viewParams.sort_columns={},a.viewParams.sort_columns[c]=-1*b,a.sort(),a.infinite()}),b.preventDefault(),!1})):void 0)}}}]).directive("columnConfig",[function(){return{restrict:"E",replace:!0,template:['<div class="column-config">','<a class="checkbox-link" href="javascript:void(0)" ng-click="column.visible = !column.visible">',' <span class="fa fw" ng-class="{\'fa-check-square-o\': column.visible, \'fa-square-o\': !column.visible}" ng-click="column.visible = !column.visible">',"</span>"," {{column.header }}","</a>",'<div class="sort-icons">','<span class="fa fa-chevron-up" ng-click="moveColumnUp()"></span><span class="fa fa-chevron-down" ng-click="moveColumnDown()"></span>',"</div>","</div>"].join(""),link:function(a,b){return a.moveColumnUp=function(){var b,c;return c=a.columns.indexOf(a.column),c>=0?(b=a.columns.splice(c,1)[0],a.columns.splice(c-1,0,b)):void 0},a.moveColumnDown=function(){var b,c;return c=a.columns.indexOf(a.column),c>=0?(b=a.columns.splice(c,1)[0],a.columns.splice(c+1,0,b)):void 0},$(b).find("a").on("click",function(a){return a.preventDefault(),!1}),$(b).find("span.fa").on("click",function(a){return a.preventDefault(),!1})}}}])}.call(this),function(){angular.module("goGridScroll",[]).directive("scrollTable",["$timeout",function(a){return{restrict:"A",link:function(b,c){var d,e,f,g;return e=c.parent().find(".go-grid-table-header"),d=function(){var a;return a=($(c).find("td ").height()||29)+1,b.viewParams.pageSize=Math.round($(c).height()/a)},$(window).resize(function(){return $.contains(document.documentElement,c[0])?(d(),g(),b.$apply()):void 0}),g=function(){var a,b,f;return a=c.parent().find(".go-grid-filters"),f=e.height(),b=a.height()+8,c.css({top:f+b}),d()},a(function(){return g()},10),b.$watch("source.data",function(a){var d,e;return a&&(d=b.source.data.filter(function(a){return a.active})[0],e=b.source.data.indexOf(d),e>=0)?setTimeout(function(){var a;return a=($(c).find("td ").height()||30)+1,b.viewParams.pageSize-1<e?c.scrollTop((e+2-b.viewParams.pageSize)*a+5):void 0},200):void 0}),b.$watch("columns",function(){return a(function(){return g()},200)},!0),b.$on("columnResize",function(){return g()}),f=c.scrollTop(),c.on("scroll",function(){var a,d;return e.scrollLeft($(this).scrollLeft()),f!==c.scrollTop()&&(f=c.scrollTop(),d=($(c).find("td ").height()||30)+1,b.viewParams.infinite&&(a=Math.round($(this).scrollTop()/d/b.viewParams.pageSize)+1,a!==b.viewParams.page))?b.$apply(function(){return function(){return b.viewParams.page=a,b.viewParams.page<0&&(b.viewParams.page=0),b.viewParams.page>b.source.data.length/b.viewParams.pageSize&&(b.viewParams.page=Math.round(b.source.data.length/b.viewParams.pageSize)),b.infinite()}}(this)):void 0})}}}])}.call(this),function(){angular.module("goGridXLSExporter",[]).service("XLSExport",function(){var a;return a=function(){function a(a,b,c){this.file_name=a,this.columns=b,this.data=c}return a.prototype.doExport=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(p={},g=[],A=this.columns,h=s=0,w=A.length;w>s;h=++s)e=A[h],e.visible&&"checkbox"!==e.type&&g.push({header:e.header,index:h,field:e.name,template:e.template,width:e.width});for(f=0,d=[],t=0,x=g.length;x>t;t++)c=g[t],b=XLSX.utils.encode_cell({c:f,r:0}),a={v:c.header,t:"s"},p[b]=a,f++,d.push({wpx:c.width});for(p["!cols"]=d,k=1,j=0,(r=XLSX.SSF._table)[50]||(r[50]="YYYY/MM/DD"),B=this.data,h=u=0,y=B.length;y>u;h=++u){for(i=B[h],f=0,v=0,z=g.length;z>v;v++)c=g[v],b=XLSX.utils.encode_cell({c:f,r:k}),a={v:i[c.field]||"",t:"s"},$.isNumeric(a.v)?a.t="n":moment(i[c.field]).isValid()&&null!=i[c.field]&&(a.t="n",a.z=XLSX.SSF._table[50],a.v=(moment(i[c.field]).toDate()-new Date(Date.UTC(1899,11,30)))/864e5),c.template&&"s"===a.t&&(a.v=$interpolate(c.template)({item:i}).replace(/(<([^>]+)>)/gi,"").trim(),a.h=$interpolate(c.template)({item:i})),p[b]=a,f>j&&(j=f),f++;k++}return p["!ref"]=XLSX.utils.encode_range({s:{c:0,r:0},e:{c:j,r:k-1}}),q="export",n={SheetNames:[q],Sheets:{}},n.Sheets[q]=p,o=XLSX.write(n,{bookType:"xlsx",bookSST:!0,type:"binary"}),l=function(a){var b,c,d,e,f;for(b=new ArrayBuffer(a.length),d=new Uint8Array(b),h=f=0,e=a.length;e>f;h=++f)c=a[h],d[h]=255&a.charCodeAt(h);return b},m=l(o),setTimeout(function(){return saveAs(new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),""+moment().format("YYYYMMDDHHmmss")+"-"+this.file_name+".xlsx")},500),!0},a}()})}.call(this),function(){angular.module("goGrid",["goGridControllers","goGridFilters","goGridClass","goGridTemplates","goGridScroll","goGridColumns"]).directive("goGrid",["$compile","$parse","$timeout","storage","$interpolate","gridClass",function(a,b,c,d,e,f){return{restrict:"A",scope:!0,controller:"GoGridController",link:function(e,g,h,i,j){var k;return e.name=b(h.name)(e),k=new f(e,g,h,i,j,c),k.buildColumns(d),k.groupColumns(),e.$watch("columns",function(){return k.watchColumns(d)},!0),h.onSelect&&(e.onSelect=e[h.onSelect.replace("()","")]),e.onSelect||(e.onSelect=function(a){var b,c,d,f;for(f=e.source.data,c=0,d=f.length;d>c;c++)b=f[c],delete b.active;return a.active=!0}),e.source={data:b(h.source)(e)},e.filtered=e.source.data,e.viewParams.infinite=null!=h.infinite,e.sort(),e.resetStorage=function(){return d.set(e.name+".columns",null),!0},e.$watch(h.source,function(){return k.watchSource(b)}),k.cellStyleSetters(),e.$watch("source.data.$trigger",function(){return e.filter()}),e.$watch("source.data.$resolved",function(){return e.viewParams.length=e.source.data.length,e.filter()}),e.viewParams.infinite?k.infiniteScroll(c):e.truncated=e.filtered,g.html("<div ng-include=\"'grid_base.html'\"></div>"),a(g.contents())(e)}}}]).directive("goCell",["$compile",function(a){return{restrict:"A",link:function(b,c){var d,e,f,g;return g=b.column.template,""===g&&(f="",b.read_only&&(f="::"),g="{{ "+f+"item."+b.column.name+" }}"),d=[],b.column.right&&d.push("text-right"),e="<div","checkbox"!==b.column.type&&(e+=' ng-click="highlight(item)"'),e+=' ng-style="columnWidth(column)"',e+=' class="'+d.join(" ")+'">'+g+"</div>",c.html(e),a(c.contents())(b)}}}])}.call(this);